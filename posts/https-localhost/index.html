<!DOCTYPE html><html lang="en"><head><title>https://localhost</title><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@VovanR"><meta name="twitter:creator" content="@VovanR"><link rel="me" href="https://mastodon.social/@vovanr"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png?v=rMMKb0vWEj"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png?v=rMMKb0vWEj"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png?v=rMMKb0vWEj"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png?v=rMMKb0vWEj"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png?v=rMMKb0vWEj"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png?v=rMMKb0vWEj"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png?v=rMMKb0vWEj"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png?v=rMMKb0vWEj"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png?v=rMMKb0vWEj"><link rel="icon" type="image/png" href="/favicon-32x32.png?v=rMMKb0vWEj" sizes="32x32"><link rel="icon" type="image/png" href="/favicon-194x194.png?v=rMMKb0vWEj" sizes="194x194"><link rel="icon" type="image/png" href="/favicon-96x96.png?v=rMMKb0vWEj" sizes="96x96"><link rel="icon" type="image/png" href="/android-chrome-192x192.png?v=rMMKb0vWEj" sizes="192x192"><link rel="icon" type="image/png" href="/favicon-16x16.png?v=rMMKb0vWEj" sizes="16x16"><link rel="manifest" href="/manifest.json?v=rMMKb0vWEj"><link rel="mask-icon" href="/safari-pinned-tab.svg?v=rMMKb0vWEj" color="#5bbad5"><link rel="shortcut icon" href="/favicon.ico?v=rMMKb0vWEj"><meta name="msapplication-TileColor" content="#154489"><meta name="msapplication-TileImage" content="/mstile-144x144.png?v=rMMKb0vWEj"><meta name="theme-color" content="#154489"><link  rel="stylesheet" href="/styles/style.css" /><script>document.querySelector('html').classList.add('js')
</script></head><body><header class="header"><div class="header__name"><div class="logo"><a class="logo__text" href="/">Vladimir Rodkin</a><span class="logo__description">About Front-end</span></div></div><div class="header__logo"><span class="logo__image logo__image_size_64"></span></div><div class="header__nav"><nav class="nav"><div class="nav__item"><a class="nav__link" href="https://vovanr.com/services/">Services</a></div><div class="nav__item"><a class="nav__link" href="https://blog.vovanr.com/">Blog</a></div><div class="nav__item"><a class="nav__link" href="https://vovanr.com/notes/">Notes</a></div></nav></div></header><div class="content"><article class="post"><h1 class="post__title">https://localhost</h1><div class="post__text"><h2 id="1-">1. Создаём корневой сертификат</h2>
<p>Генерируем ключ (RSA-2048 key)</p>
<pre class="highlight"><code class="hljs bash">openssl genrsa -des3 -out rootCA.key 2048</code></pre>
<p>Генерируем корневой сертификат (Root SSL certificate)</p>
<pre class="highlight"><code class="hljs bash">openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 1024 -out rootCA.pem</code></pre>
<h2 id="2-">2. Добавляем корневой сертификат в список доверенных</h2>
<h3 id="ubuntu">Ubuntu</h3>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Network_Security_Services">Network Security Services</a> — Просмотр и управление сертификатами для браузеров</li>
<li><a href="https://superuser.com/a/657177/274603">Mozilla NSS library</a> — Почему <code>update-ca-certificates</code> недостаточно</li>
<li><a href="https://github.com/dakshshah96/local-cert-generator">local-cert-generator</a></li>
</ul>
<pre class="highlight"><code class="hljs bash">sudo cp rootCA.pem /usr/<span class="hljs-built_in">local</span>/share/ca-certificates/rootCA.crt
sudo update-ca-certificates</code></pre>
<p><strong>Добавляем корневой сертификат в Firefox и Chrome</strong></p>
<pre class="highlight"><code class="hljs bash">sudo apt install libnss3-tools
openssl pkcs12 -<span class="hljs-built_in">export</span> -out rootCA.pfx -inkey rootCA.key -<span class="hljs-keyword">in</span> rootCA.crt
pk12util -d sql:<span class="hljs-variable">$HOME</span>/.pki/nssdb -i rootCA.pfx
certutil -d sql:<span class="hljs-variable">$HOME</span>/.pki/nssdb -A -t <span class="hljs-string">"C,,"</span> -n myapp-certificate -i rootCA.pem</code></pre>
<p>Перезагружаем браузер.</p>
<p>Если не помогло:</p>
<ul>
<li>Firefox: <em>Preferences</em> → <em>Privacy &amp; Security</em> → <em>Certificates</em> → <em>View Certificates...</em> → <em>Authorities</em> → <em>Import...</em> → выбираем <code>rootCA.pem</code></li>
<li>Chrome: <em>Settings</em> → <em>Privacy and security</em> → <em>Manage certificates</em> → <em>Authorities</em> → <em>Import</em> → выбираем <code>rootCA.pem</code></li>
</ul>
<p>Перезагружаем браузер.</p>
<h3 id="windows-7">Windows 7</h3>
<ul>
<li><a href="https://blogs.technet.microsoft.com/sbs/2008/05/08/installing-a-self-signed-certificate-as-a-trusted-root-ca-in-windows-vista/">Installing a Self-Signed Certificate as a Trusted Root CA in Windows Vista</a></li>
</ul>
<p><em>Пуск</em> → <em>Панель управления</em> → <em>Свойства браузера</em> → <em>Содержание</em> → <em>Сертификаты</em> → <em>Доверенные корневые центры сертификации</em><br>Жмём кнопку <em>«Импорт»</em></p>
<h3 id="windows-10">Windows 10</h3>
<p><em>Start</em> → <em>Control Panel</em> → <em>Network and Internet</em> → <em>Internet Options</em> → <em>Content</em> → <em>Certificates</em> → <em>Trusted Root Certification Authorities</em><br><em>Import...</em> → <em>Next</em> → Выбрать <code>rootCA.pfx</code> → <em>Next</em> → Заполнить <em>Password</em> → <em>Next</em> → <em>Finish</em><br>Security warning → <em>Yes</em></p>
<h2 id="3-">3. Создаём сертификат домена</h2>
<p>Создаём файл <code>server.csr.cnf</code> со следующим содержимым.<br>В котором <code>CN</code> — доменное имя. Остальные поля заполняются как на шаге создания корневого сертификата.</p>
<pre class="highlight"><code class="hljs ini"><span class="hljs-section">[req]</span>
<span class="hljs-attr">default_bits</span>=<span class="hljs-number">2048</span>
<span class="hljs-attr">prompt</span>=<span class="hljs-literal">no</span>
<span class="hljs-attr">default_md</span>=sha256
<span class="hljs-attr">distinguished_name</span>=req_distinguished_name

<span class="hljs-section">[req_distinguished_name]</span>
<span class="hljs-attr">C</span>=RU
<span class="hljs-attr">ST</span>=Saint-Petersburg
<span class="hljs-attr">L</span>=Saint-Petersburg
<span class="hljs-attr">O</span>=RandomOrganization
<span class="hljs-attr">OU</span>=RandomOrganizationUnit
<span class="hljs-attr">emailAddress</span>=hello@example.com
<span class="hljs-attr">CN</span>=localhost</code></pre><p>Создаём файл <code>v3.ext</code><br>Где <code>DNS.1</code> — как поле <code>CN</code> в файле <code>server.csr.cnf</code></p>
<pre class="highlight"><code class="hljs ini"><span class="hljs-attr">authorityKeyIdentifier</span>=keyid,issuer
<span class="hljs-attr">basicConstraints</span>=CA:<span class="hljs-literal">FALSE</span>
<span class="hljs-attr">keyUsage</span> = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
<span class="hljs-attr">subjectAltName</span> = @alt_names

<span class="hljs-section">[alt_names]</span>
<span class="hljs-attr">DNS.1</span> = localhost</code></pre><p>Генерируем доменный ключ</p>
<pre class="highlight"><code class="hljs bash">openssl req -new -sha256 -nodes -out server.csr -newkey rsa:2048 -keyout server.key -config server.csr.cnf</code></pre>
<p>Генерируем доменный сертификат</p>
<pre class="highlight"><code class="hljs bash">openssl x509 -req -<span class="hljs-keyword">in</span> server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 500 -sha256 -extfile v3.ext</code></pre>
<p>Помещаем сгенерированные ключ и сертификат в директорию для Докер-контейнера</p>
<pre class="highlight"><code class="hljs awk">nginx<span class="hljs-regexp">/etc/</span>ssl<span class="hljs-regexp">/certs/</span>server.crt
nginx<span class="hljs-regexp">/etc/</span>ssl<span class="hljs-regexp">/private/</span>server.key</code></pre><h2 id="4-https-nginx-">4. Добавляем настройки для работы HTTPS в <em>NGINX-конфиг</em></h2>
<pre class="highlight"><code class="hljs diff">. . .

 http {
   server {
<span class="hljs-deletion">-    listen 7272;</span>
<span class="hljs-addition">+    listen 7272 ssl;</span>

<span class="hljs-addition">+    ssl_certificate /etc/ssl/certs/server.crt;</span>
<span class="hljs-addition">+    ssl_certificate_key /etc/ssl/private/server.key;</span>

     . . .</code></pre>
<h2 id="5-nginx-">5. Обновляем команду запуска <em>NGINX</em> Докер-контейнера</h2>
<pre class="highlight"><code class="hljs diff"> docker run --rm -it -p 7272:7272 \
   -v $(pwd)/nginx:/etc/nginx:ro \
<span class="hljs-addition">+  -v $(pwd)/nginx/etc/ssl/certs:/etc/ssl/certs \</span>
<span class="hljs-addition">+  -v $(pwd)/nginx/etc/ssl/private:/etc/ssl/private \</span>
   --name myapp-nginx nginx</code></pre>
<h2 id="-">Дополнительные материалы</h2>
<ul>
<li><a href="https://github.com/twitchdev/extensions-samples/tree/master/boilerplate">Twitch Extensions Boilerplate</a></li>
<li><a href="https://medium.freecodecamp.org/how-to-get-https-working-on-your-local-development-environment-in-5-minutes-7af615770eec">How to get HTTPS working on your local development environment in 5 minutes</a></li>
</ul>
</div><div class="post__meta"><a class="post__source" href="https://github.com/VovanR/VovanR.github.io/src/documents/posts/https-localhost.html.md" target="_blank" rel="noopener">Source code</a><div class="tags post__tags"><span class="tags__tag">Development</span><span class="tags__tag">Docker</span><span class="tags__tag">Ubuntu</span><span class="tags__tag">Windows</span></div><time class="post__date" datetime="2019-10-15">October 15, 2019</time><div class="post__share"><script src="/vendor/likely/likely.js"></script><link rel="stylesheet" href="/vendor/likely/likely.css"/><div class="likely"><div class="twitter"></div><div class="vkontakte"></div><div class="telegram"></div><div class="odnoklassniki"></div><div class="linkedin"></div></div></div></div></article></div><footer class="footer"><div class="footer__social-list"><a href="https://twitter.com/VovanR" rel="me">Twitter</a><a href="https://mastodon.social/@vovanr" rel="me">Mastodon</a><a href="https://github.com/VovanR" rel="me">GitHub</a><a href="https://www.npmjs.com/~vovanr" rel="me">npm</a></div><div class="footer__copyright"><a href="https://github.com/vovanr/vovanr.github.io">©&nbsp;Vladimir Rodkin, 2023</a></div><div class="footer__build-info">This&nbsp;site&nbsp;is&nbsp;powered&nbsp;by&nbsp;<a href='https://docpad.org'>DocPad</a>, and&nbsp;hosted&nbsp;on&nbsp;<a href='https://pages.github.com/'>GitHub&nbsp;Pages</a><br/>
<a href="https://stats.uptimerobot.com/w2yzATL2ZR">Statuspage</a></div></footer></body></html>